---
title: "שיעור 2: יסודות מידע מרחבי, שימוש בסיסי ב-qgis"
author: 'ד"ר עדו קליין'
date: 11/03/24
execute: 
  echo: false
  warning: false
  cache: true
format:
  html:
    css: style.css
    toc: true
    toc-location: right
    number-sections: true
    code-fold: false
    link-external-newwindow: true
  revealjs:
    output-file: index-slides.html
editor: visual
---

```{ojs}
//| echo: false
now = new Date
```

## תזכורת לשיעור הקודם

חילקנו בין שני סוגים של מידע מרחבי:

-   ::: fragment
    מידע וקטורי
    :::

-   ::: fragment
    מידע רסטרי
    :::

::: fragment
מרבית הקורס יסוב סביב מידע וקטורי.
:::

## מהו מידע וקטורי?

כהרגלנו, ננסה לפרק את המושג לחתיכות:

::: fragment
מידע - דנו עליו בשיעור הקודם.
:::

::: fragment
וקטור - מה זה?
:::

::: fragment
וקטור הוא שם שונה למערך. מערך הוא מבנה נתונים - אוסף נתונים שניתן לגשת אליו באמצעות אינדקס, מצביע.
:::

## כזכור, עקב בצד אגודל...

מה זה אומר?

::: fragment
נניח יש רשימה של מספרים:
:::

::: fragment
\[6,1,2,3,4,7\]
:::

::: fragment
מה המשמעות של האיבר הNי ברשימה?
:::

::: fragment
האיבר הראשון ברשימה הוא 6.
:::

::: fragment
האיבר השני ברשימה הוא 1.
:::

::: fragment
וכן הלאה.
:::

## איך הרשימה מסומנת במרחב?

איך **מה** מסומן **איפה**?

## איך מסמנים דברים במרחב?

::: fragment
צריך מערכת צירים.
:::

::: fragment
איך נראה ציר מספרים? ככה:
:::

::: fragment
```{r}
#| cache: true
#| echo: false
#| 
library(ggplot2)
library(patchwork)
c(6,1,2,3,4,7) |> setNames(1:6) |> stack() |>  ggplot(aes(x = values,y = "1",label = values)) + geom_label()

```
:::

## איך המספרים מסומנים במרחב? {.smaller}

::: fragment
איך היינו מסמנים את הרשימה במרחב חד מימדי? \[6,1,2,3,4,7\]
:::

::: fragment
```{r}
#| cache: true

li <- c(6,1,2,3,4,7)
setNames(li,1:6) |> stack() |> ggplot(aes(x = values,y = "1",label = ind)) + geom_label()
```
:::

## זה יכול להיות גם (קצת) מסובך יותר

::: fragment
נניח יש לי רשימה בתוך רשימה:
:::

::: fragment
\[\[1,2\],\[3,4\],\[5,6\]\]
:::

::: fragment
מהו האיבר הNי ברשימה?
:::

::: fragment
האיבר הראשון ברשימה הוא \[1,2\]
:::

::: fragment
האיבר הראשון באיבר הראשון הוא 1.
:::

## למה סיבכנו?

כי ברוב מוחלט של המקרים, מידע גאוגרפי מכיל שני נתונים כאלה.

::: columns
::: column
::: fragment
::: ltr
| index | x   | y   |
|-------|-----|-----|
| 1     | 1   | 2   |
| 2     | 3   | 4   |
| 3     | 5   | 6   |
:::
:::
:::

::: column
::: fragment
ולכן צריך שני צירים, כאלה:

```{r}
#| cache: true
li <- data.frame(x = c(1,3,5),y = c(2,4,6),ind = c(1,2,3))
ggplot(li,aes(x = x,y = y,label = ind)) + geom_label(size = 20) + theme(text = element_text(size = 30)) + coord_cartesian(xlim = c(0,7),ylim = c(0,7))
```
:::
:::
:::

## רגע, זה טוב רק לנקודות, מה עם קווים?

::: fragment
איך נייצג אותם על מערכת צירים?
:::

::: fragment
רשימה משולשת:
:::

::: fragment
\[\[\[1,1\],\[2,2\],\[3,3\]\],\[\[4,4\],\[5,5\]\]\]
:::

::: fragment
מהו האיבר הNי ברשימה?
:::

::: fragment
האיבר הראשון ברשימה הוא \[\[1,1\],\[2,2\],\[3,3\]\]
:::

::: fragment
האיבר הראשון באיבר הראשון הוא \[1,1\]
:::

::: fragment
האיבר הראשון באיבר הראשון באיבר הראשון הוא 1
:::

## ובייצוג פשוט יותר {.smaller}

::: columns
::: column
::: fragment
::: ltr
| index | element | x   | y   |
|-------|---------|-----|-----|
| 1     | 1       | 1   | 1   |
| 1     | 2       | 2   | 2   |
| 1     | 3       | 3   | 3   |
| 2     | 1       | 4   | 4   |
| 2     | 2       | 5   | 5   |
:::
:::
:::

::: column
::: fragment
```{r}
#| cache: true
li <- data.frame(x = 1:5, xend = c(2:3,NA,5,NA),y = 1:5,yend = c(2:3,NA,5,NA),ind = c(1,1,1,2,2))
ggplot(li,aes(x = x,xend = xend,y = y,yend=yend,label = x, color = as.character(ind) )) + geom_segment() +geom_label(size = 20) + theme(text = element_text(size = 30)) + coord_cartesian(xlim = c(0,7),ylim = c(0,7)) + scale_color_discrete(guide = F)
```
:::
:::
:::

## אוקיי, יש נקודות, יש קווים, מה עם מצולעים?

מצולע - צורה סגורה. מעתה נקרא לה פוליגון.

```{r}
#| cache: true
li <- data.frame(x = c(0,1,1,0,0), xend = c(1,1,0,0,NA),y =c(0,0,1,1,0),yend = c(0,1,1,0,NA))
ggplot(li,aes(x=x,xend=xend,y=y,yend=yend)) + geom_segment()

```

## למעשה, הייצוג שלה זהה לזה של קו, למעט...

זה שהנקודה הראשונה והאחרונה זהות.

```{r}
#| cache: true
li <- data.frame(x = c(0,1,1,0,0), xend = c(1,1,0,0,NA),y =c(0,0,1,1,0),yend = c(0,1,1,0,NA))
p1<-ggplot(li[1:3,],aes(x=x,xend=xend,y=y,yend=yend,color = c("a","a","a"),label = paste(x,y,sep = ","))) + geom_segment() + geom_label() + scale_color_discrete(guide = F)
p2<-ggplot(li[1:4,],aes(x=x,xend=xend,y=y,yend=yend,color = c("a","a","a","b"),label = paste(x,y,sep = ","))) + geom_segment() + geom_label() + scale_color_discrete(guide = F)
p1 + p2

```

## נניח יש לי תופעה שמיוצגת בכמה מקומות, למשל:

השטח המוניציפלי של דימונה:

![](images/paste-1.png)

. . .

מה עושים?

## אפשר לכלול כמה ישויות שרוצים בתוך הרשימה שדיברנו עליה

וזה נקרא מולטי-ישות. לנקודה - מולטי נקודה לקו - מולטי קו לפוליגון - מולטי פוליגון

## שימו לב!

בתאוריה בטבלה אחת ניתן לייצג כמה סוגי ישויות -לערבב בטבלה אחת קו, נקודה ופוליגון. בקורס זה **לא** נעשה זאת.

## המחשה נוספת

נניח יש לנו את הטבלה הזאת:

::: columns
::: column
::: fragment
::: {dir="ltr"}
|     |     |     |      |     |            |
|-----|-----|-----|------|-----|------------|
| id  | x   | y   | name | age | eyes_color |
| 1   | 70  | 70  | sam  | 72  | black      |
| 2   | 38  | 20  | pam  | 62  | brown      |
| 3   | 62  | 30  | wham | 45  | blue       |
:::
:::
:::
:::
---------------------------------------------------------------------------------  

::: fragment
היא תיוצג ככה על גבי מפה:

```{r}
#| cache: true
df <- data.frame(x = c(70, 38, 62), y= c(70,20,30), name = c("sam","pam","wham"),age = c(72,62,45),eyes_color = c("black","brown","blue"))
df |>
  ggplot(aes(x,y, label = paste(name,age,eyes_color,sep = "\n"))) + geom_label(size = 10) + coord_cartesian(c(0,100),c(0,100)) + theme(text = element_text(size = 30))
```
:::


## הפסקה מתודית

## עבודה בסיסית עם תוכנת qgis

נפתח את התוכנה.

![](images/paste-2.png)

זה מסך הפתיחה שלי. הוא יחסית עם הרבה "צעצועים" עליו, תוספים וכיו"ב.

עם זאת, למטרת הקורס פתחתי פרופיל נקי, ללא תוספים. (גם אתם יכולים לעשות זאת, אם תרצו, בהמשך הקורס נלמד איך)

## טעינת שכבות {.smaller}

שכבה = טבלה עם "עמודה" המתארת מיקום במרחב.

קידוד המיקום במרחב, בעבר, היה תובעני מבחינת מקום על הכונן.

כיום בעייה זו פחות חריפה עבור רוב השימושים היומיומיים, עם זאת, מרבית הקבצים המקובלים בשימוש כיום הם קבצי shp.

על מנת לטעון קובץ shp, חשוב **מאוד** לוודא כי הוא נמצא ב**אותה התיקייה** יחד עם לפחות עוד שני קבצים:

קובץ DBF (שלמעשה מכיל את טבלת הנתונים)

קובץ SHX (המכיל את האינדקס, ההקשר המרחבי. אין צורך לצלול לעומק בנושא זה)

בשלב זה של הקורס נשתמש בקבצים המקובלים בשימוש בתעשייה, קבצי shp.

## איך נטען שכבה?

יש דרכים יותר "מסודרות" לעשות זאת. אבל נלמד אותן בהמשך הקורס.

בשלב זה, נפתח את מיקום הקובץ שהורדנו בסייר הקבצים, ופשוט נגרור אותו לתוך התוכנה, כפי שמודגם בסרטון:

![](images/Untitled%20video%20-%20Made%20with%20Clipchamp.gif){width="500"}

## שכבת בסיס

מישהו יכול לנחש איפה אנחנו? מה אנחנו רואים?

::: fragment
אתם לא חייבים לנחש, זאת מכללת תל חי.

איך נדע זאת בלי קשר?
:::

::: fragment
נוסיף שכבת בסיס.

שכבות בסיס למעשה מחוברות לשרת באינטרנט המאפשר להן "למשוך" את התמונות מהאיזור הרלוונטי.
:::

------------------------------------------------------------------------

לא חובה להשתמש בהן - לפעמים יותר יפה בלי

[(מתוך הבלוג של אלון סיגלר)](https://www.lastmile.co.il/post/nofit)

![https://static.wixstatic.com/media/0d4905_c42bc4ef0ae945bdacbdf1ec9687e2b4\~mv2.jpg/v1/fill/w_740,h_740,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/0d4905_c42bc4ef0ae945bdacbdf1ec9687e2b4\~mv2.jpg](images/paste-3.png){width="461"}

------------------------------------------------------------------------

ובכל זאת, ניתן להוסיף שכבת בסיס באמצעות פאנל הסיור (יוסבר עוד 3 שקפים), כפי שניתן לראות בסרטון:

![](images/Untitled%20video%20-%20Made%20with%20Clipchamp%20(1).gif){width="500"}

## סרגל הניווט

אז יש לנו את הישויות הגאוגרפיות עם מפת הרקע. זהו?

לא, אפשר גם לנווט, להגדיל ולהקטין.

![](images/paste-4.png)

מזמין אתכם להתנסות במקשים השונים, בעיקר במקשים היותר שמאליים.

במידה ויש לכם גלגלת בעכבר - ניתן לעשות זום אין וזום אאוט.

אתם לא מוצאים את סרגל הניווט?

------------------------------------------------------------------------

ניתן להוסיף/להוריד סרגלים ופאנלים, ככה(כפתור ימני על העכבר)

![](images/Untitled%20video%20-%20Made%20with%20Clipchamp%20(2).gif)

## פאנל השכבות

פעמים רבות מאוד, ישויות שונות בשכבות שונות יהיו אחת על גבי השנייה. לכן סדר השכבות חשוב מאוד.

![](images/paste-5.png)

------------------------------------------------------------------------

בפאנל זה ניתן לגרור את השכבות אחת מעל השנייה (יחד עם עוד שלל פעולות) על מנת לקבוע את סדרן.

![](images/Untitled%20video%20-%20Made%20with%20Clipchamp%20(3).gif){width="500"}

## פאנל הסיור

דומה לסייר הקבצים במחשב. מאפשר חיפוש של קבצים אך גם קישורים למקורות אינטרנטיים של שכבות (עליהם נלמד בהמשך הקורס)

![](images/paste-6.png)

## סרגל המאפיינים {.smaller}

![](images/paste-7.png)

![](images/paste-8.png)

מאפשר בחינה של ישויות. **לחצו** על הכפתור ואז על ישות על גבי המפה בשביל להתנסות

![](images/paste-9.png)

מאפשר פתיחה של טבלת הישויות. **לחצו** בשביל להתנסות ולראות את הטבלה.  

------------------------------------------------------------------------
![](images/paste-10.png)

מאפשר מדידה של קו, שטח, כיוון או זווית, לבחירתכם. השימוש בו אינטואיטיבי.

## סרגל הפרויקט

![](images/paste-11.png)

העבודה בqgis מתבצעת בפרויקטים.

## מהו פרויקט?

אם נדבר במונחי powerpoint - הפרויקט מאגד את כלל השכבות בסדר, בסגנון ובמאפיינים, בדיוק כמו שמצגת מאגדת שקפים ותמונות.

עם זאת, לאור העובדה שלרוב פרויקטים מתבססים על שכבות שונות - הפרויקט (לרוב,לא בהכרח, בהמשך הקורס נלמד אחרת) מאגד בין כלל הקבצים הטעונים בתוכנה בזמן מסוים.

ולכן(בינתיים), כשנעבוד על פרויקט, נעשה זאת בתיקייה חדשה ונקייה, כאשר כלל הקבצים שמורים בתוכה, בצורה שלא ניתן להעביר קבצים ממקום למקום למחשב, כי זה יפגע בפרויקט.

## הדגמה של שמירת פרויקט

בכיתה. יהיה קיים בהקלטה.

## תרגיל 2 {.smaller}

**הורידו** את החומרים לתרגיל מדף המטלה באתר הקורס.

**שמרו** פרויקט חדש בו יש:

-   שכבת בסיס לבחירתכם.

-   שכבת הפוליגונים/ מבנים מעליה.

-   שכבת הקווים/כבישים מעליה.

-   שכבת הנקודות/תחנות האוטובוס מעליה.

**שמרו** את כלל הקבצים בקובץ זיפ, כולל קובץ הפרויקט.

**ודאו** שהפרויקט עובד לאחר אנזיפ של הקבצים במקום אחר במחשב.

**שלחו** את קובץ הזיפ, בו קיים גם קובץ הפרויקט, שניתן לפותחו.